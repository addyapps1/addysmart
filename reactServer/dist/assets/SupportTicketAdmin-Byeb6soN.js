import{j as e,r,A as v,u as w}from"./index-kR-aReZW.js";import"./sweetalert2.esm.all-BGf-Fe8G.js";import{M as T}from"./AddyMine-D2d0Guu5.js";import{M as k}from"./MineHelmet-Dlyk2kUQ.js";import{B as b}from"./BeatLoader-14DkuQDB.js";import"./useClickOutside-DlfaV4Ao.js";import"./Helmet-CjJ5bfs9.js";const C=({supportticket:s,onOpenTicket:a})=>e.jsx("section",{className:"flex justify-center items-center mx-6 mb-14",children:e.jsxs("div",{className:"bg-[var(--container-bg-color)] text-[var(--highlight-color)] cards-container flex max-w-[850px] flex-wrap w-full justify-center gap-6 rounded-md",children:[e.jsxs("div",{className:"flex-grow min-h-16 flex justify-center flex-col items-center rounded-md",children:[e.jsxs("h2",{className:"w-full text-center font-semibold",children:["Title: ",s.issueTitle]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Description: ",s.issueDescription]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Priority: ",s.priority]})]}),e.jsxs("div",{className:"flex-grow min-h-16 flex justify-center flex-col items-center rounded-md",children:[e.jsxs("h2",{className:"w-full text-center font-semibold",children:["status: ",s.status]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["category:",s.categor]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["created: ",s.created]})]}),e.jsx("div",{className:"w-full flex justify-center items-center rounded-md",children:e.jsx("div",{onClick:a,role:"button","aria-label":"Open support ticket",className:"w-full flex-grow min-h-16 flex justify-center items-center rounded-md bg-[var(--accent-color)] max-w-[400px] cursor-pointer hover:bg-opacity-90",children:"Read"})})]})}),I=()=>{var u,f,h;const{isLoggedIn:s,getStoredUserObj:a,getStoredToken:j,setPageTitle:n}=r.useContext(v),{API_supportBase_url:d,supportTickets:c,setSupportTickets:y}=r.useContext(T),[m,p]=r.useState(!1),[o,N]=r.useState({}),l=w();r.useEffect(()=>{s()||l("/")},[s,l]),r.useEffect(()=>{n("SUPPORT TICKET(A)"),N(a())},[a,n]);const x=async()=>{p(!0);try{let t;a().role.includes("supreme")||a().role.includes("supportmanager")?t=`${d}api/a/v1.00/supportticket/agenthead`:t=`${d}api/a/v1.00/supportticket/agent`,console.log("supportticketURL",t);const g=await fetch(t,{method:"GET",headers:{"Content-Type":"application/json",authorization:`Bearer ${j()}`}});console.log("response",g);const i=await g.json();if(i.status==="success"&&i.data)console.log("Fetched Support Tickets:",i.data),y(i.data),console.log("supportTickets",c);else throw new Error(i.message||"Failed to fetch support tickets.")}catch(t){console.error("Request failed:",t)}finally{p(!1)}};return r.useEffect(()=>{x()},[]),e.jsxs(e.Fragment,{children:[e.jsx(k,{pageDescription:"Welcome to Addysmart mining support ticket page where you can view all available support tickets.",pageName:"addymine/supportticket",pageTitle:"Addysmart - Support Tickets"}),e.jsx("section",{className:"flex justify-center items-center mx-6 mb-6 mt-10",children:e.jsx("div",{className:"cards-container flex max-w-[850px] flex-wrap w-full justify-center gap-6",children:e.jsxs("div",{className:"bg-[var(--container-bg-color)] w-full flex-grow min-h-16 flex-col flex justify-center items-center rounded-md",children:[e.jsxs("h1",{className:"w-full text-center mt-5 m-0 text-[var(--highlight-color)] text-2xl",children:[`${((u=o.userTitle)==null?void 0:u.toUpperCase())||"User"} 
              ${((f=o.firstName)==null?void 0:f.toUpperCase())||""} 
              ${((h=o.lastName)==null?void 0:h.toUpperCase())||""}`,o.isVIP&&e.jsx("em",{className:"text-[var(--good)]",children:" (VIP)"})]}),e.jsx("p",{className:"w-full text-center m-2",children:e.jsx("b",{onClick:x,className:"bg-[var(--accent-color)] p-1 px-2 rounded cursor-pointer",children:"Reload Tickets"})})]})})}),m?e.jsx("div",{className:"flex justify-center items-center mt-10",children:e.jsx(b,{color:"#ffffff",loading:m,size:8})}):c&&c.length>0?c.map(t=>e.jsx("div",{className:"ticket-item",children:e.jsx(C,{supportticket:t,onOpenTicket:()=>l(`../ticketchatadmin/${t._id}`)})},t._id)):e.jsx("div",{className:"flex justify-center items-center mt-10",children:"You have no support ticket yet."})]})};export{I as default};
