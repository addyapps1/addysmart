import{j as e,r as t,A as q,u as O}from"./index-CxbHE0pI.js";import{M as A}from"./AddyMine-WSYQUIhP.js";import{B as D}from"./BeatLoader-Pg87K8qw.js";import{S as l}from"./sweetalert2.esm.all-BGf-Fe8G.js";import{c as V}from"./line-md--menu-to-close-transition-CEm-3zyw.js";import{P as Q}from"./Pagination-IN6nXI7o.js";import{M as X}from"./MineHelmet-CPD-h0TO.js";import"./useClickOutside-B_P1bOg4.js";import"./Helmet-CSCbi4JC.js";const Z=({task:a,openModal:x,isObjLoading:h,handleDeleteTask:p})=>e.jsx("section",{className:"flex justify-center items-center mx-6 mb-14 ",children:e.jsxs("div",{className:"bg-[var(--container-bg-color)] text-[var(--highlight-color)] flex max-w-[850px] flex-wrap w-full justify-center gap-6 rounded-md",children:[e.jsxs("div",{className:"w-full min-h-16 px-4 flex flex-col justify-center items-center rounded-md",children:[a.instructions,e.jsx("a",{href:a.link,target:"_blank",rel:"noopener noreferrer",className:"w-full rounded text-center",children:a.link}),e.jsx("p",{children:a.challengeType}),e.jsx("p",{children:a.vidStatus})]}),e.jsx("div",{onClick:()=>x(a._id),className:"bg-[var(--accent-color)] basis-80 px-4 flex-grow min-h-16 flex justify-center items-center rounded-md cursor-pointer",children:"Edit"}),e.jsx("div",{onClick:()=>p(a._id),className:"bg-[var(--warning-color)] text-[var(--warning-color2)] basis-80 px-4 flex-grow min-h-16 flex justify-center items-center rounded-md cursor-pointer",children:h[a._id]?e.jsx(D,{color:"#ffffff",loading:h[a._id],size:8}):"Delete"},a._id)]})}),ee=({isOpen:a,onClose:x})=>{const{API_E_VideoBase_url:h,tasks:p,setTasks:C}=t.useContext(A),{logout:E,getStoredToken:S}=t.useContext(q),[b,r]=t.useState(""),[f,y]=t.useState(""),[d,g]=t.useState(!1),[u,T]=t.useState(""),[v,j]=t.useState(""),[w,I]=t.useState(""),M=O(),P=()=>b.trim()?f.trim()?u.trim()?!0:(l.fire("Instructions cannot be empty"),!1):(l.fire("Watchcode cannot be empty"),!1):(l.fire("Link cannot be empty"),!1),N=async n=>{if(n.preventDefault(),g(!0),!P()){g(!1);return}try{let m=`${h()}api/a/v1.00/evideo`;const c=await(await fetch(m,{method:"POST",headers:{"Content-Type":"application/json",authorization:`Bearer ${S()}`},body:JSON.stringify({link:b,watchcode:f,instructions:u,challengeType:v,vidStatus:w})})).json();if(c&&c.data)l.fire("Task created successfully"),C([c.data,...p]),x();else throw new Error("Invalid response data")}catch(m){console.error("Task creation failed:",m),l.fire("Task creation failed"),(m=="Error: jwt expired"||m=="Error: Device mismatch. Please login again")&&(l.fire("Your login expired, please login again."),E(),M("/"))}finally{g(!1)}};return e.jsx(e.Fragment,{children:a&&e.jsx("div",{id:"watchcodeModal",className:" fixed inset-0 bg-black bg-opacity-50 flex items-start justify-center max-h-[100vh] overflow-y-scroll z-[101] py-5",children:e.jsxs("div",{className:"bg-white dark:bg-black rounded-lg shadow-lg p-6 w-full max-w-md",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-primary",children:"Submit Task Details"}),e.jsx("div",{children:e.jsx("img",{src:V,alt:"profileImage",className:"pagelogo w-6 aspect-square rounded-full mx-auto",title:"close modal",onClick:x})})]}),e.jsxs("form",{onSubmit:N,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"link",className:"block font-bold text-primary mb-2",children:"Link"}),e.jsx("input",{type:"text",id:"link",name:"link",placeholder:"Enter the link here",value:b,onChange:n=>r(n.target.value),required:!0,className:"w-full p-3 text-[var(--secondary-text-color)] border border-gray-300 dark:border-gray-700 rounded focus:ring focus:ring-highlight-color transition duration-200 ease-in-out"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"watchcode",className:"block font-bold text-primary mb-2",children:"Watchcode"}),e.jsx("textarea",{id:"watchcode",name:"watchcode",rows:"2",placeholder:"Enter the watchcode here",value:f,onChange:n=>y(n.target.value),required:!0,className:"w-full p-3 text-[var(--secondary-text-color)] border border-gray-300 dark:border-gray-700 rounded focus:ring focus:ring-highlight-color transition duration-200 ease-in-out"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"instructions",className:"block font-bold text-primary mb-2",children:"Instructions"}),e.jsx("textarea",{id:"instructions",name:"instructions",rows:"2",placeholder:"Enter the instructions here",value:u,onChange:n=>T(n.target.value),required:!0,className:"w-full p-3 text-[var(--secondary-text-color)] border border-gray-300 dark:border-gray-700 rounded focus:ring focus:ring-highlight-color transition duration-200 ease-in-out"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"chellenetype",className:"block font-bold text-primary mb-2",children:"Chellenetype"}),e.jsxs("select",{id:"chellenetype",name:"chellenetype",value:v,onChange:n=>j(n.target.value),required:!0,className:"w-full p-3 text-[var(--secondary-text-color)] border border-gray-300 dark:border-gray-700 rounded focus:ring focus:ring-highlight-color transition duration-200 ease-in-out",children:[e.jsx("option",{value:"",disabled:!0,children:"Select a Chellenetype"}),e.jsx("option",{value:"watchcode",children:"WatchCode"}),e.jsx("option",{value:"wordoccurrence",children:"WordOccurrence"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"videostatus",className:"block font-bold text-primary mb-2",children:"Videostatus"}),e.jsxs("select",{id:"videostatus",name:"videostatus",value:w,onChange:n=>I(n.target.value),required:!0,className:"w-full p-3 text-[var(--secondary-text-color)] border border-gray-300 dark:border-gray-700 rounded focus:ring focus:ring-highlight-color transition duration-200 ease-in-out",children:[e.jsx("option",{value:"",disabled:!0,children:"Select a Videostatus"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"}),e.jsx("option",{value:"pending",children:"Pending"})]})]}),e.jsx("div",{className:"text-center",children:e.jsx("button",{type:"submit",className:"bg-highlight-color hover:bg-secondary-accent-color text-white font-bold py-3 px-6 rounded-lg transition duration-200 ease-in-out",disabled:d,children:d?e.jsx(D,{color:"#ffffff",loading:d,size:8}):"Create"})})]})]})})})},te=({taskID:a,isOpen:x,onClose:h})=>{const{API_E_VideoBase_url:p,tasks:C,setTasks:E}=t.useContext(A),{logout:S,getStoredToken:b}=t.useContext(q),r=C.find(o=>o._id===a),[f,y]=t.useState((r==null?void 0:r.link)||""),[d,g]=t.useState((r==null?void 0:r.watchcode)||""),[u,T]=t.useState((r==null?void 0:r.instructions)||""),[v,j]=t.useState(!1),[w,I]=t.useState((r==null?void 0:r.challengeType)||""),[M,P]=t.useState((r==null?void 0:r.vidStatus)||""),N=O();t.useEffect(()=>{y((r==null?void 0:r.link)||""),g((r==null?void 0:r.watchcode)||""),T((r==null?void 0:r.instructions)||"")},[r]);const n=()=>f.trim()?d.trim()?u.trim()?!0:(l.fire("Instructions cannot be empty"),!1):(l.fire("Watchcode cannot be empty"),!1):(l.fire("Link cannot be empty"),!1),m=async o=>{if(o.preventDefault(),j(!0),!n()){j(!1);return}try{let c=`${p()}api/a/v1.00/evideo/${r._id}`;const k=await(await fetch(c,{method:"PUT",headers:{"Content-Type":"application/json",authorization:`Bearer ${b()}`},body:JSON.stringify({link:f,watchcode:d,instructions:u,challengeType:w,vidStatus:M})})).json();if(k&&k.data)l.fire("Task updated successfully"),E(L=>L.map(_=>_._id===r._id?k.data:_)),h();else throw new Error("Invalid response data")}catch(c){console.error("Task update failed:",c),l.fire("Task update failed"),(c=="Error: jwt expired"||c=="Error: Device mismatch. Please login again")&&(l.fire("Your login expired, please login again."),S(),N("/"))}finally{j(!1)}};return e.jsx(e.Fragment,{children:x&&e.jsx("div",{id:"watchcodeModal",className:"fixed inset-0 bg-black bg-opacity-50 flex items-start justify-center max-h-[100vh] overflow-y-scroll z-[101] py-5",children:e.jsxs("div",{className:"bg-white dark:bg-black rounded-lg shadow-lg p-6 w-full max-w-md",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-primary",children:"Edit Task Details"}),e.jsx("div",{children:e.jsx("img",{src:V,alt:"profileImage",className:"pagelogo w-6 aspect-square rounded-full mx-auto",title:"close modal",onClick:h})})]}),e.jsxs("form",{onSubmit:m,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"link",className:"block font-bold text-primary mb-2",children:"Link"}),e.jsx("input",{type:"text",id:"link",name:"link",placeholder:"Enter the link here",value:f,onChange:o=>y(o.target.value),required:!0,className:"w-full p-3 border text-[var(--secondary-text-color)] border-gray-300 dark:border-gray-700 rounded focus:ring transition duration-200 ease-in-out"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"watchcode",className:"block font-bold text-primary mb-2",children:"Watchcode"}),e.jsx("textarea",{id:"watchcode",name:"watchcode",rows:"2",placeholder:"Enter the watchcode here",value:d,onChange:o=>g(o.target.value),required:!0,className:"w-full p-3 border text-[var(--secondary-text-color)] border-gray-300 dark:border-gray-700 rounded focus:ring transition duration-200 ease-in-out"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"instructions",className:"block font-bold text-primary mb-2",children:"Instructions"}),e.jsx("textarea",{id:"instructions",name:"instructions",rows:"2",placeholder:"Enter the instructions here",value:u,onChange:o=>T(o.target.value),required:!0,className:"w-full p-3 border text-[var(--secondary-text-color)] border-gray-300 dark:border-gray-700 rounded focus:ring transition duration-200 ease-in-out"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"chellenetype",className:"block font-bold text-primary mb-2",children:"Chellenetype"}),e.jsxs("select",{id:"chellenetype",name:"chellenetype",value:w,onChange:o=>I(o.target.value),required:!0,className:"w-full p-3 text-[var(--secondary-text-color)] border border-gray-300 dark:border-gray-700 rounded focus:ring focus:ring-highlight-color transition duration-200 ease-in-out",children:[e.jsx("option",{value:"",disabled:!0,children:"Select a Chellenetype"}),e.jsx("option",{value:"watchcode",children:"WatchCode"}),e.jsx("option",{value:"wordoccurrence",children:"WordOccurrence"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"videostatus",className:"block font-bold text-primary mb-2",children:"Videostatus"}),e.jsxs("select",{id:"videostatus",name:"videostatus",value:M,onChange:o=>P(o.target.value),required:!0,className:"w-full p-3 text-[var(--secondary-text-color)] border border-gray-300 dark:border-gray-700 rounded focus:ring focus:ring-highlight-color transition duration-200 ease-in-out",children:[e.jsx("option",{value:"",disabled:!0,children:"Select a Videostatus"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"}),e.jsx("option",{value:"pending",children:"Pending"})]})]}),e.jsx("div",{className:"text-center",children:e.jsx("button",{type:"submit",className:"bg-highlight-color hover:bg-secondary-accent-color text-white font-bold py-3 px-6 rounded-lg transition duration-200 ease-in-out",disabled:v,children:v?e.jsx(D,{color:"#ffffff",loading:v,size:8}):"Update"})})]})]})})})},ue=()=>{var U,R,W;const{logout:a,isLoggedIn:x,getStoredUserObj:h,getStoredToken:p,setPageTitle:C,APP_NAME:E}=t.useContext(q),{API_E_VideoBase_url:S,tasks:b,setTasks:r}=t.useContext(A),[f,y]=t.useState(!0),[d,g]=t.useState({}),[u,T]=t.useState({}),[v,j]=t.useState(null),[w,I]=t.useState(!1),[M,P]=t.useState(!1),[N,n]=t.useState(1),[m,o]=t.useState(0),c=12;let $=t.useRef();const k=O();t.useEffect(()=>{x()||k("/")},[x,k]),t.useEffect(()=>{C("MANAGE TASKS")},[C]),t.useEffect(()=>{T(h())},[h]);const L=async()=>{y(!0);try{const i=`${S()}api/a/v1.00/evideo?page=${N}&limit=${c}`,s=await(await fetch(i,{method:"GET",credentials:"include",headers:{"Content-Type":"application/json",authorization:`Bearer ${p()}`}})).json();if(s.status==="success"&&s.data)console.log("tasksData",s),r(s.data),s.RecordsEstimate&&o(s.RecordsEstimate);else throw new Error(s.message)}catch(i){(i=="Error: jwt expired"||i=="Error: Device mismatch. Please login again")&&(l.fire("Your login expired, please login again."),a(),k("/")),console.error("Request failed:",i)}finally{y(!1)}};$.current=L,t.useEffect(()=>{$.current()},[N]),t.useEffect(()=>{console.log("isObjLoading",d)},[d]);const _=async i=>{if(window.confirm("Are you sure you want to delete this task?")){g(s=>({...s,[i]:!0}));try{const s=`${S()}api/a/v1.00/evideo/${i}`,z=await fetch(s,{method:"DELETE",credentials:"include",headers:{"Content-Type":"application/json",authorization:`Bearer ${p()}`}});if(z.ok)r(F=>F.filter(K=>K._id!==i));else{const F=await z.json();throw new Error(F.message)}}catch(s){(s=="Error: jwt expired"||s=="Error: Device mismatch. Please login again")&&(l.fire("Your login expired, please login again."),a()),console.error("Delete request failed:",s)}finally{g(s=>({...s,[i]:!1}))}}};t.useEffect(()=>{L()},[]);const B=i=>{j(i),I(!0)},Y=()=>{P(!0)},G=()=>{I(!1),j(null)},J=()=>{P(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(X,{pageDescription:`Welcome to  ${E.toLowerCase()} mining tasks page where admins manage and create tasks`,pageName:"addymine/managetasks",pageTitle:`${E} - Manage Mining Tasks`}),e.jsx("section",{className:"flex justify-center items-center mx-6 mb-6 mt-10",children:e.jsx("div",{className:"cards-container flex max-w-[850px] flex-wrap w-full justify-center gap-6",children:e.jsxs("div",{className:"bg-[var(--container-bg-color)] w-full flex-grow min-h-16 flex-col flex justify-center items-center rounded-md",children:[e.jsx("h1",{className:"w-full text-center mt-3 text-[var(--highlight-color)] text-2xl",children:`${((U=u.userTitle)==null?void 0:U.toUpperCase())||""} 
              ${((R=u.firstName)==null?void 0:R.toUpperCase())||""} 
              ${((W=u.lastName)==null?void 0:W.toUpperCase())||""}`}),e.jsx("p",{className:"w-full text-center m-2",children:e.jsx("b",{onClick:Y,className:" text-white bg-[var(--accent-color)] p-1 px-2 rounded cursor-pointer",children:"Create Task"})})]})})}),f?e.jsx("div",{className:"flex justify-center items-center mt-10",children:e.jsx(D,{color:"#ffffff",loading:f,size:8})}):b.length>0?b.map(i=>e.jsx("div",{className:"task-item",children:e.jsx(Z,{task:i,isObjLoading:d,handleDeleteTask:_,openModal:B})},i._id)):e.jsx("p",{className:"text-center",children:"No task found."}),e.jsx(ee,{isOpen:M,onClose:J}),e.jsx(te,{taskID:v,isOpen:w,onClose:G}),m>c&&e.jsx(Q,{totalPages:Math.ceil(m/c),currentPage:N,onPageChange:n})]})};export{ue as default};
