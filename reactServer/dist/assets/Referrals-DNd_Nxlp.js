import{j as t,r,A,u as L}from"./index-CxbHE0pI.js";import{M}from"./AddyMine-WSYQUIhP.js";import{a as T}from"./useClickOutside-B_P1bOg4.js";import{P as _}from"./Pagination-IN6nXI7o.js";import{M as k}from"./MineHelmet-CPD-h0TO.js";import{S as B}from"./sweetalert2.esm.all-BGf-Fe8G.js";import{B as F}from"./BeatLoader-Pg87K8qw.js";import"./Helmet-CSCbi4JC.js";const q=({rUser:e,viewReferral:m})=>{var d,i,n,u,c,g,h,p,f;let l=T;return(d=e==null?void 0:e.profileImg)!=null&&d.filePath&&(l=e.profileImg.filePath),console.log("rUser",e),t.jsx("section",{className:"flex justify-center items-center mx-6 mb-6",children:t.jsx("div",{className:"bg-[var(--container-bg-color)] text-[var(--highlight-color)] cards-container flex max-w-[850px] flex-wrap w-full justify-center gap-6 rounded-md",children:t.jsxs("div",{className:"w-full flex-grow min-h-16 flex justify-between items-center rounded-md p-4",onClick:()=>m(e),children:[t.jsx("b",{className:" flex-grow",children:`${((n=(i=e==null?void 0:e.referred)==null?void 0:i.userTitle)==null?void 0:n.toUpperCase())||""} 
              ${((c=(u=e==null?void 0:e.referred)==null?void 0:u.firstName)==null?void 0:c.toUpperCase())||""} 
              ${((h=(g=e==null?void 0:e.referred)==null?void 0:g.middleName)==null?void 0:h.toUpperCase())||""} 
              ${((f=(p=e==null?void 0:e.referred)==null?void 0:p.lastName)==null?void 0:f.toUpperCase())||""}`}),t.jsx("img",{src:l,alt:"profileImage",className:" w-10 aspect-square rounded-full mx-auto",title:"profile image"})]})})})},K=()=>{var C,E,y;const{logout:e,isLoggedIn:m,getStoredUserObj:l,getStoredToken:d,setPageTitle:i,APP_NAME:n}=r.useContext(A),{API_AuthBase_url:u,referrals:c,setReferrals:g,viewingReferral:h,setViewingReferral:p}=r.useContext(M),[f,N]=r.useState(!1),[s,$]=r.useState({}),[j,b]=r.useState(1),[P,D]=r.useState(0),R=12;let v=r.useRef();const x=L();r.useEffect(()=>{m()||x("/")},[m,x]),r.useEffect(()=>{i("REFERRALS")},[i]),r.useEffect(()=>{const a=l();$(a),console.log("User.referalID",a.referalID)},[l]);const I=a=>{var w;if(!a){console.error("No referral User provided");return}p(a),x(`../referralprofile/${(w=a==null?void 0:a.referred)==null?void 0:w._id}`)},S=async()=>{if(s.referalID){N(!0),console.log("Fetching data for user:",s);try{const a=`${u()}api/a/v1.00/referral/user?page=${j}&limit=${R}`,o=await(await fetch(a,{method:"GET",headers:{"Content-Type":"application/json",authorization:`Bearer ${d()}`}})).json();if(o.status==="success"&&o.data)g(o.data),console.log("ReferralsData",o),D(o.RecordsEstimate||0);else throw new Error(o.message)}catch(a){(a=="Error: jwt expired"||a=="Error: Device mismatch. Please login again")&&(B.fire("Your login expired, please login again."),e(),x("/")),console.error("Request failed:",a.message)}finally{N(!1)}}};return v.current=S,r.useEffect(()=>{s.referalID&&v.current()},[j,s.referalID]),t.jsxs(t.Fragment,{children:[t.jsx(k,{pageDescription:`Welcome to ${n.toLowerCase()} mining referrals page, where you see data about your referrals`,pageName:"addymine/referrals",pageTitle:`${n} - Mining referrals`}),t.jsx("section",{className:"flex justify-center items-center mx-6 mb-6 mt-10",children:t.jsx("div",{className:"cards-container flex max-w-[850px] flex-wrap w-full justify-center gap-6",children:t.jsxs("div",{className:"bg-[var(--container-bg-color)] w-full flex-grow min-h-16 flex-col flex justify-center items-center rounded-md",children:[t.jsx("h1",{className:"w-full text-center mt-5 m-0 text-[var(--highlight-color)] text-2xl",children:`${((C=s.userTitle)==null?void 0:C.toUpperCase())||"User"} 
              ${((E=s.firstName)==null?void 0:E.toUpperCase())||"Unknown"} 
              ${((y=s.lastName)==null?void 0:y.toUpperCase())||"User"}`}),t.jsx("p",{className:"w-full text-center mb-2",children:"Referrals"})]})})}),f?t.jsx("div",{className:"flex justify-center items-center mt-10",children:t.jsx(F,{color:"#ffffff",loading:f,size:8})}):c.length>0?c.map(a=>t.jsx("div",{className:"task-item",children:t.jsx(q,{rUser:a,viewReferral:I})},a._id)):t.jsx("p",{className:"text-center",children:"No referrals found."}),P>0&&t.jsx(_,{totalPages:Math.ceil(P/R)||1,currentPage:j,onPageChange:b})]})};export{K as default};
