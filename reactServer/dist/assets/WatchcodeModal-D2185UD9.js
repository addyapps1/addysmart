import{j as e,r as n,A as S,u as C}from"./index-CxbHE0pI.js";import{S as r}from"./sweetalert2.esm.all-BGf-Fe8G.js";import{M as T}from"./AddyMine-WSYQUIhP.js";import{c as k}from"./line-md--menu-to-close-transition-CEm-3zyw.js";import{B as M}from"./BeatLoader-Pg87K8qw.js";const _=({task:t,onWatchCodeClick:i,alertViewed:s})=>e.jsx("section",{className:"flex justify-center items-center mx-6 mb-14",children:e.jsxs("div",{className:"bg-[var(--container-bg-color)] text-[var(--highlight-color)] cards-container flex max-w-[850px] flex-wrap w-full justify-center gap-6 rounded-md",children:[e.jsxs("div",{className:"w-full px-4 flex-grow min-h-16 flex justify-center flex-col items-center rounded-md",children:[e.jsx("h2",{className:"w-full text-center",children:"INSTRUCTIONS"}),e.jsx("b",{children:t.instructions})]},t._id),e.jsx("div",{onClick:t.justViewed?s:i,className:"basis-80 flex-grow min-h-16  flex justify-center items-center rounded-md bg-[var(--accent-color)] max-w-[400px]",children:e.jsx("a",{href:t.link,target:"_blank",rel:"noopener noreferrer",className:`button h-full flex justify-center items-center ${t.justViewed?"text-[var(--bad)]":"text-[var(--good)]"} w-full rounded text-center`,children:t.justViewed?"Done":"Do Task"})})]})}),$=({videoId:t,isOpen:i,onClose:s})=>{const{logout:g,getStoredToken:p}=n.useContext(S),{API_MineBase_url:j,setTasks:w,setBalance:b}=n.useContext(T),[l,h]=n.useState(""),[c,d]=n.useState(!1),y=C(),v=()=>l.trim()?!0:(r.fire("Watchcode cannot be empty"),!1),N=async m=>{if(m.preventDefault(),d(!0),!v()){d(!1);return}try{console.log("WatchcodeModal videoId",t);const a=await(await fetch(`${j()}api/a/v1.00/coinmining`,{method:"POST",headers:{"Content-Type":"application/json",authorization:`Bearer ${p()}`},body:JSON.stringify({watchcode:l,videoId:t})})).json();if(console.log("data",a),a&&a.alreadydone)r.fire(`${a.alreadydone}`);else if(a&&a.data)r.fire(`${a.data.newCoins} shares mined successfully`),w(f=>{console.log("Previous tasks:",f);const x=f.map(u=>u._id===t?{...u,justViewed:!0}:u);return console.log("Updated tasks:",x),x}),b(a.data),h(""),s();else throw new Error("Invalid response data")}catch(o){console.error("Shares mining failed:",o),r.fire("Shares mining failed"),(o=="Error: jwt expired"||o=="Error: Device mismatch. Please login again")&&(r.fire("Your login expired, please login again."),g(),y("/"))}finally{d(!1)}};return e.jsx(e.Fragment,{children:i&&e.jsx("div",{id:"watchcodeModal",className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center max-h-[95vh] overflow-y-scroll z-[101] my-5",children:e.jsxs("div",{className:"bg-white dark:bg-black rounded-lg shadow-lg p-6 w-full max-w-md",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-primary",children:"Watchcode challenge"}),e.jsx("div",{children:e.jsx("img",{src:k,alt:"profileImage",className:"pagelogo w-6 aspect-square rounded-full mx-auto",title:"close modal",onClick:s})})]}),e.jsxs("form",{onSubmit:N,className:"space-y-6",children:[e.jsx("input",{type:"hidden",name:"video-id",value:t}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"watchcode",className:"block font-bold text-primary mb-2",children:"Watchcode"}),e.jsx("textarea",{id:"watchcode",name:"watchcode",rows:"2",placeholder:"Enter the watchcode here",value:l,onChange:m=>h(m.target.value),required:!0,className:"w-full p-3 text-[var(--secondary-text-color)] border border-gray-300 dark:border-gray-700 rounded focus:ring focus:ring-highlight-color transition duration-200 ease-in-out"})]}),e.jsx("div",{className:"text-center",children:e.jsx("button",{type:"submit",className:"bg-highlight-color hover:bg-secondary-accent-color text-white font-bold py-3 px-6 rounded-lg transition duration-200 ease-in-out",disabled:c,children:c?e.jsx(M,{color:"#ffffff",loading:c,size:8}):"Mine"})})]})]})})})};export{_ as T,$ as W};
