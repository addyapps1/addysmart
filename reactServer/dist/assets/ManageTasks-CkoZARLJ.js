import{j as e,r as t,A as q,u as O}from"./index-kR-aReZW.js";import{M as A}from"./AddyMine-D2d0Guu5.js";import{B as D}from"./BeatLoader-14DkuQDB.js";import{S as l}from"./sweetalert2.esm.all-BGf-Fe8G.js";import{c as V}from"./line-md--menu-to-close-transition-CEm-3zyw.js";import{P as Q}from"./Pagination-BLL0UuSX.js";import{M as X}from"./MineHelmet-Dlyk2kUQ.js";import"./useClickOutside-DlfaV4Ao.js";import"./Helmet-CjJ5bfs9.js";const Z=({task:a,openModal:m,isObjLoading:h,handleDeleteTask:p})=>e.jsx("section",{className:"flex justify-center items-center mx-6 mb-14 ",children:e.jsxs("div",{className:"bg-[var(--container-bg-color)] text-[var(--highlight-color)] flex max-w-[850px] flex-wrap w-full justify-center gap-6 rounded-md",children:[e.jsxs("div",{className:"w-full min-h-16 px-4 flex flex-col justify-center items-center rounded-md",children:[a.instructions,e.jsx("a",{href:a.link,target:"_blank",rel:"noopener noreferrer",className:"w-full rounded text-center",children:a.link}),e.jsx("p",{children:a.challengeType}),e.jsx("p",{children:a.vidStatus})]}),e.jsx("div",{onClick:()=>m(a._id),className:"bg-[var(--accent-color)] basis-80 px-4 flex-grow min-h-16 flex justify-center items-center rounded-md cursor-pointer",children:"Edit"}),e.jsx("div",{onClick:()=>p(a._id),className:"bg-[var(--warning-color)] text-[var(--warning-color2)] basis-80 px-4 flex-grow min-h-16 flex justify-center items-center rounded-md cursor-pointer",children:h[a._id]?e.jsx(D,{color:"#ffffff",loading:h[a._id],size:8}):"Delete"},a._id)]})}),ee=({isOpen:a,onClose:m})=>{const{API_E_VideoBase_url:h,tasks:p,setTasks:C}=t.useContext(A),{logout:S,getStoredToken:E}=t.useContext(q),[b,r]=t.useState(""),[f,y]=t.useState(""),[d,x]=t.useState(!1),[u,T]=t.useState(""),[v,j]=t.useState(""),[w,I]=t.useState(""),M=O(),L=()=>b.trim()?f.trim()?u.trim()?!0:(l.fire("Instructions cannot be empty"),!1):(l.fire("Watchcode cannot be empty"),!1):(l.fire("Link cannot be empty"),!1),N=async n=>{if(n.preventDefault(),x(!0),!L()){x(!1);return}try{let g=`${h()}api/a/v1.00/evideo`;const c=await(await fetch(g,{method:"POST",headers:{"Content-Type":"application/json",authorization:`Bearer ${E()}`},body:JSON.stringify({link:b,watchcode:f,instructions:u,challengeType:v,vidStatus:w})})).json();if(c&&c.data)l.fire("Task created successfully"),C([c.data,...p]),m();else throw new Error("Invalid response data")}catch(g){console.error("Task creation failed:",g),l.fire("Task creation failed"),g=="Error: jwt expired"&&(l.fire("Your login expired, please login again."),S(),M("/"))}finally{x(!1)}};return e.jsx(e.Fragment,{children:a&&e.jsx("div",{id:"watchcodeModal",className:" fixed inset-0 bg-black bg-opacity-50 flex items-start justify-center max-h-[100vh] overflow-y-scroll z-[101] py-5",children:e.jsxs("div",{className:"bg-white dark:bg-black rounded-lg shadow-lg p-6 w-full max-w-md",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-primary",children:"Submit Task Details"}),e.jsx("div",{children:e.jsx("img",{src:V,alt:"profileImage",className:"pagelogo w-6 aspect-square rounded-full mx-auto",title:"close modal",onClick:m})})]}),e.jsxs("form",{onSubmit:N,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"link",className:"block font-bold text-primary mb-2",children:"Link"}),e.jsx("input",{type:"text",id:"link",name:"link",placeholder:"Enter the link here",value:b,onChange:n=>r(n.target.value),required:!0,className:"w-full p-3 text-[var(--secondary-text-color)] border border-gray-300 dark:border-gray-700 rounded focus:ring focus:ring-highlight-color transition duration-200 ease-in-out"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"watchcode",className:"block font-bold text-primary mb-2",children:"Watchcode"}),e.jsx("textarea",{id:"watchcode",name:"watchcode",rows:"2",placeholder:"Enter the watchcode here",value:f,onChange:n=>y(n.target.value),required:!0,className:"w-full p-3 text-[var(--secondary-text-color)] border border-gray-300 dark:border-gray-700 rounded focus:ring focus:ring-highlight-color transition duration-200 ease-in-out"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"instructions",className:"block font-bold text-primary mb-2",children:"Instructions"}),e.jsx("textarea",{id:"instructions",name:"instructions",rows:"2",placeholder:"Enter the instructions here",value:u,onChange:n=>T(n.target.value),required:!0,className:"w-full p-3 text-[var(--secondary-text-color)] border border-gray-300 dark:border-gray-700 rounded focus:ring focus:ring-highlight-color transition duration-200 ease-in-out"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"chellenetype",className:"block font-bold text-primary mb-2",children:"Chellenetype"}),e.jsxs("select",{id:"chellenetype",name:"chellenetype",value:v,onChange:n=>j(n.target.value),required:!0,className:"w-full p-3 text-[var(--secondary-text-color)] border border-gray-300 dark:border-gray-700 rounded focus:ring focus:ring-highlight-color transition duration-200 ease-in-out",children:[e.jsx("option",{value:"",disabled:!0,children:"Select a Chellenetype"}),e.jsx("option",{value:"watchcode",children:"WatchCode"}),e.jsx("option",{value:"wordoccurrence",children:"WordOccurrence"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"videostatus",className:"block font-bold text-primary mb-2",children:"Videostatus"}),e.jsxs("select",{id:"videostatus",name:"videostatus",value:w,onChange:n=>I(n.target.value),required:!0,className:"w-full p-3 text-[var(--secondary-text-color)] border border-gray-300 dark:border-gray-700 rounded focus:ring focus:ring-highlight-color transition duration-200 ease-in-out",children:[e.jsx("option",{value:"",disabled:!0,children:"Select a Videostatus"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"}),e.jsx("option",{value:"pending",children:"Pending"})]})]}),e.jsx("div",{className:"text-center",children:e.jsx("button",{type:"submit",className:"bg-highlight-color hover:bg-secondary-accent-color text-white font-bold py-3 px-6 rounded-lg transition duration-200 ease-in-out",disabled:d,children:d?e.jsx(D,{color:"#ffffff",loading:d,size:8}):"Create"})})]})]})})})},te=({taskID:a,isOpen:m,onClose:h})=>{const{API_E_VideoBase_url:p,tasks:C,setTasks:S}=t.useContext(A),{logout:E,getStoredToken:b}=t.useContext(q),r=C.find(s=>s._id===a),[f,y]=t.useState((r==null?void 0:r.link)||""),[d,x]=t.useState((r==null?void 0:r.watchcode)||""),[u,T]=t.useState((r==null?void 0:r.instructions)||""),[v,j]=t.useState(!1),[w,I]=t.useState((r==null?void 0:r.challengeType)||""),[M,L]=t.useState((r==null?void 0:r.vidStatus)||""),N=O();t.useEffect(()=>{y((r==null?void 0:r.link)||""),x((r==null?void 0:r.watchcode)||""),T((r==null?void 0:r.instructions)||"")},[r]);const n=()=>f.trim()?d.trim()?u.trim()?!0:(l.fire("Instructions cannot be empty"),!1):(l.fire("Watchcode cannot be empty"),!1):(l.fire("Link cannot be empty"),!1),g=async s=>{if(s.preventDefault(),j(!0),!n()){j(!1);return}try{let c=`${p()}api/a/v1.00/evideo/${r._id}`;const k=await(await fetch(c,{method:"PUT",headers:{"Content-Type":"application/json",authorization:`Bearer ${b()}`},body:JSON.stringify({link:f,watchcode:d,instructions:u,challengeType:w,vidStatus:M})})).json();if(k&&k.data)l.fire("Task updated successfully"),S(_=>_.map(P=>P._id===r._id?k.data:P)),h();else throw new Error("Invalid response data")}catch(c){console.error("Task update failed:",c),l.fire("Task update failed"),c=="Error: jwt expired"&&(l.fire("Your login expired, please login again."),E(),N("/"))}finally{j(!1)}};return e.jsx(e.Fragment,{children:m&&e.jsx("div",{id:"watchcodeModal",className:"fixed inset-0 bg-black bg-opacity-50 flex items-start justify-center max-h-[100vh] overflow-y-scroll z-[101] py-5",children:e.jsxs("div",{className:"bg-white dark:bg-black rounded-lg shadow-lg p-6 w-full max-w-md",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-primary",children:"Edit Task Details"}),e.jsx("div",{children:e.jsx("img",{src:V,alt:"profileImage",className:"pagelogo w-6 aspect-square rounded-full mx-auto",title:"close modal",onClick:h})})]}),e.jsxs("form",{onSubmit:g,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"link",className:"block font-bold text-primary mb-2",children:"Link"}),e.jsx("input",{type:"text",id:"link",name:"link",placeholder:"Enter the link here",value:f,onChange:s=>y(s.target.value),required:!0,className:"w-full p-3 border text-[var(--secondary-text-color)] border-gray-300 dark:border-gray-700 rounded focus:ring transition duration-200 ease-in-out"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"watchcode",className:"block font-bold text-primary mb-2",children:"Watchcode"}),e.jsx("textarea",{id:"watchcode",name:"watchcode",rows:"2",placeholder:"Enter the watchcode here",value:d,onChange:s=>x(s.target.value),required:!0,className:"w-full p-3 border text-[var(--secondary-text-color)] border-gray-300 dark:border-gray-700 rounded focus:ring transition duration-200 ease-in-out"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"instructions",className:"block font-bold text-primary mb-2",children:"Instructions"}),e.jsx("textarea",{id:"instructions",name:"instructions",rows:"2",placeholder:"Enter the instructions here",value:u,onChange:s=>T(s.target.value),required:!0,className:"w-full p-3 border text-[var(--secondary-text-color)] border-gray-300 dark:border-gray-700 rounded focus:ring transition duration-200 ease-in-out"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"chellenetype",className:"block font-bold text-primary mb-2",children:"Chellenetype"}),e.jsxs("select",{id:"chellenetype",name:"chellenetype",value:w,onChange:s=>I(s.target.value),required:!0,className:"w-full p-3 text-[var(--secondary-text-color)] border border-gray-300 dark:border-gray-700 rounded focus:ring focus:ring-highlight-color transition duration-200 ease-in-out",children:[e.jsx("option",{value:"",disabled:!0,children:"Select a Chellenetype"}),e.jsx("option",{value:"watchcode",children:"WatchCode"}),e.jsx("option",{value:"wordoccurrence",children:"WordOccurrence"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"videostatus",className:"block font-bold text-primary mb-2",children:"Videostatus"}),e.jsxs("select",{id:"videostatus",name:"videostatus",value:M,onChange:s=>L(s.target.value),required:!0,className:"w-full p-3 text-[var(--secondary-text-color)] border border-gray-300 dark:border-gray-700 rounded focus:ring focus:ring-highlight-color transition duration-200 ease-in-out",children:[e.jsx("option",{value:"",disabled:!0,children:"Select a Videostatus"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"}),e.jsx("option",{value:"pending",children:"Pending"})]})]}),e.jsx("div",{className:"text-center",children:e.jsx("button",{type:"submit",className:"bg-highlight-color hover:bg-secondary-accent-color text-white font-bold py-3 px-6 rounded-lg transition duration-200 ease-in-out",disabled:v,children:v?e.jsx(D,{color:"#ffffff",loading:v,size:8}):"Update"})})]})]})})})},ue=()=>{var U,R,W;const{logout:a,isLoggedIn:m,getStoredUserObj:h,getStoredToken:p,setPageTitle:C,APP_NAME:S}=t.useContext(q),{API_E_VideoBase_url:E,tasks:b,setTasks:r}=t.useContext(A),[f,y]=t.useState(!0),[d,x]=t.useState({}),[u,T]=t.useState({}),[v,j]=t.useState(null),[w,I]=t.useState(!1),[M,L]=t.useState(!1),[N,n]=t.useState(1),[g,s]=t.useState(0),c=12;let $=t.useRef();const k=O();t.useEffect(()=>{m()||k("/")},[m,k]),t.useEffect(()=>{C("MANAGE TASKS")},[C]),t.useEffect(()=>{T(h())},[h]);const _=async()=>{y(!0);try{const i=`${E()}api/a/v1.00/evideo?page=${N}&limit=${c}`,o=await(await fetch(i,{method:"GET",credentials:"include",headers:{"Content-Type":"application/json",authorization:`Bearer ${p()}`}})).json();if(o.status==="success"&&o.data)console.log("tasksData",o),r(o.data),o.RecordsEstimate&&s(o.RecordsEstimate);else throw new Error(o.message)}catch(i){i=="Error: jwt expired"&&(l.fire("Your login expired, please login again."),a(),k("/")),console.error("Request failed:",i)}finally{y(!1)}};$.current=_,t.useEffect(()=>{$.current()},[N]),t.useEffect(()=>{console.log("isObjLoading",d)},[d]);const P=async i=>{if(window.confirm("Are you sure you want to delete this task?")){x(o=>({...o,[i]:!0}));try{const o=`${E()}api/a/v1.00/evideo/${i}`,z=await fetch(o,{method:"DELETE",credentials:"include",headers:{"Content-Type":"application/json",authorization:`Bearer ${p()}`}});if(z.ok)r(F=>F.filter(K=>K._id!==i));else{const F=await z.json();throw new Error(F.message)}}catch(o){o=="Error: jwt expired"&&(l.fire("Your login expired, please login again."),a()),console.error("Delete request failed:",o)}finally{x(o=>({...o,[i]:!1}))}}};t.useEffect(()=>{_()},[]);const B=i=>{j(i),I(!0)},Y=()=>{L(!0)},G=()=>{I(!1),j(null)},J=()=>{L(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(X,{pageDescription:`Welcome to  ${S.toLowerCase()} mining tasks page where admins manage and create tasks`,pageName:"addymine/managetasks",pageTitle:`${S} - Manage Mining Tasks`}),e.jsx("section",{className:"flex justify-center items-center mx-6 mb-6 mt-10",children:e.jsx("div",{className:"cards-container flex max-w-[850px] flex-wrap w-full justify-center gap-6",children:e.jsxs("div",{className:"bg-[var(--container-bg-color)] w-full flex-grow min-h-16 flex-col flex justify-center items-center rounded-md",children:[e.jsx("h1",{className:"w-full text-center mt-3 text-[var(--highlight-color)] text-2xl",children:`${((U=u.userTitle)==null?void 0:U.toUpperCase())||""} 
              ${((R=u.firstName)==null?void 0:R.toUpperCase())||""} 
              ${((W=u.lastName)==null?void 0:W.toUpperCase())||""}`}),e.jsx("p",{className:"w-full text-center m-2",children:e.jsx("b",{onClick:Y,className:" text-white bg-[var(--accent-color)] p-1 px-2 rounded cursor-pointer",children:"Create Task"})})]})})}),f?e.jsx("div",{className:"flex justify-center items-center mt-10",children:e.jsx(D,{color:"#ffffff",loading:f,size:8})}):b.length>0?b.map(i=>e.jsx("div",{className:"task-item",children:e.jsx(Z,{task:i,isObjLoading:d,handleDeleteTask:P,openModal:B})},i._id)):e.jsx("p",{className:"text-center",children:"No task found."}),e.jsx(ee,{isOpen:M,onClose:J}),e.jsx(te,{taskID:v,isOpen:w,onClose:G}),g>c&&e.jsx(Q,{totalPages:Math.ceil(g/c),currentPage:N,onPageChange:n})]})};export{ue as default};
