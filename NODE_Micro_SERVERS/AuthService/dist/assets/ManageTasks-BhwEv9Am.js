import{j as e,r,A as _,u as R}from"./index-DWis4S1t.js";import{M as I}from"./AddyMine-CwKyk6rd.js";import{B as M}from"./BeatLoader-CfJHUm3g.js";import{S as f}from"./sweetalert2.esm.all-BGf-Fe8G.js";const W=({task:a,openModal:h,isObjLoading:c,handleDeleteTask:x})=>e.jsx("section",{className:"flex justify-center items-center mx-6 mb-14",children:e.jsxs("div",{className:"bg-[var(--container-bg-color)] text-[var(--highlight-color)] flex max-w-[850px] flex-wrap w-full justify-center gap-6",children:[e.jsxs("div",{className:"w-full min-h-16 flex flex-col justify-center items-center rounded-md",children:[a.instructions,e.jsx("a",{href:a.link,target:"_blank",rel:"noopener noreferrer",className:"w-full rounded text-center",children:a.link})]}),e.jsx("div",{onClick:()=>h(a._id),className:"bg-[var(--accent-color)] basis-80 flex-grow min-h-16 flex justify-center items-center rounded-md cursor-pointer",children:"Edit"}),e.jsx("div",{onClick:()=>x(a._id),className:"bg-[var(--warning-color)] text-[var(--warning-color2)] basis-80 flex-grow min-h-16 flex justify-center items-center rounded-md cursor-pointer",children:c[a._id]?e.jsx(M,{color:"#ffffff",loading:c[a._id],size:8}):"Delete"},a._id)]})}),V=({isOpen:a,onClose:h})=>{const{API_E_VideoBase_url:c,tasks:x,setTasks:j,setBalance:E}=r.useContext(I),{getStoredToken:w}=r.useContext(_),[t,v]=r.useState(""),[p,m]=r.useState(""),[d,g]=r.useState(""),[u,i]=r.useState(!1),b=()=>t.trim()?p.trim()?d.trim()?!0:(f.fire("Instructions cannot be empty"),!1):(f.fire("Watchcode cannot be empty"),!1):(f.fire("Link cannot be empty"),!1),k=async l=>{if(l.preventDefault(),i(!0),!b()){i(!1);return}try{let s=`${c}api/a/v1.00/evideo`;const y=await(await fetch(s,{method:"POST",headers:{"Content-Type":"application/json",authorization:`Bearer ${w()}`},body:JSON.stringify({link:t,watchcode:p,instructions:d})})).json();if(y&&y.data)f.fire("Task created successfully"),j([y.data,...x]),h();else throw new Error("Invalid response data")}catch(s){console.error("Task creation failed:",s),f.fire("Task creation failed")}finally{i(!1)}};return e.jsx(e.Fragment,{children:a&&e.jsx("div",{id:"watchcodeModal",className:" fixed inset-0 bg-black bg-opacity-50 flex items-start justify-center max-h-[100vh] overflow-y-scroll z-[101] py-5",children:e.jsxs("div",{className:"bg-white dark:bg-black rounded-lg shadow-lg p-6 w-full max-w-md",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-primary",children:"Submit Task Details"}),e.jsx("button",{onClick:h,className:"text-gray-500 hover:text-gray-800 dark:text-gray-300 dark:hover:text-white rounded-full",children:"✖"})]}),e.jsxs("form",{onSubmit:k,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"link",className:"block font-bold text-primary mb-2",children:"Link"}),e.jsx("input",{type:"text",id:"link",name:"link",placeholder:"Enter the link here",value:t,onChange:l=>v(l.target.value),required:!0,className:"w-full p-3 text-[var(--secondary-text-color)] border border-gray-300 dark:border-gray-700 rounded focus:ring focus:ring-highlight-color transition duration-200 ease-in-out"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"watchcode",className:"block font-bold text-primary mb-2",children:"Watchcode"}),e.jsx("textarea",{id:"watchcode",name:"watchcode",rows:"2",placeholder:"Enter the watchcode here",value:p,onChange:l=>m(l.target.value),required:!0,className:"w-full p-3 text-[var(--secondary-text-color)] border border-gray-300 dark:border-gray-700 rounded focus:ring focus:ring-highlight-color transition duration-200 ease-in-out"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"instructions",className:"block font-bold text-primary mb-2",children:"Instructions"}),e.jsx("textarea",{id:"instructions",name:"instructions",rows:"2",placeholder:"Enter the instructions here",value:d,onChange:l=>g(l.target.value),required:!0,className:"w-full p-3 text-[var(--secondary-text-color)] border border-gray-300 dark:border-gray-700 rounded focus:ring focus:ring-highlight-color transition duration-200 ease-in-out"})]}),e.jsx("div",{className:"text-center",children:e.jsx("button",{type:"submit",className:"bg-highlight-color hover:bg-secondary-accent-color text-white font-bold py-3 px-6 rounded-lg transition duration-200 ease-in-out",disabled:u,children:u?e.jsx(M,{color:"#ffffff",loading:u,size:8}):"Create"})})]})]})})})},G=({taskID:a,isOpen:h,onClose:c})=>{const{API_E_VideoBase_url:x,tasks:j,setTasks:E}=r.useContext(I),{getStoredToken:w}=r.useContext(_),t=j.find(s=>s._id===a),[v,p]=r.useState((t==null?void 0:t.link)||""),[m,d]=r.useState((t==null?void 0:t.watchcode)||""),[g,u]=r.useState((t==null?void 0:t.instructions)||""),[i,b]=r.useState(!1);r.useEffect(()=>{p((t==null?void 0:t.link)||""),d((t==null?void 0:t.watchcode)||""),u((t==null?void 0:t.instructions)||"")},[t]);const k=()=>v.trim()?m.trim()?g.trim()?!0:(f.fire("Instructions cannot be empty"),!1):(f.fire("Watchcode cannot be empty"),!1):(f.fire("Link cannot be empty"),!1),l=async s=>{if(s.preventDefault(),b(!0),!k()){b(!1);return}try{let N=`${x}api/a/v1.00/evideo/${t._id}`;const C=await(await fetch(N,{method:"PUT",headers:{"Content-Type":"application/json",authorization:`Bearer ${w()}`},body:JSON.stringify({link:v,watchcode:m,instructions:g})})).json();if(C&&C.data)f.fire("Task updated successfully"),E(S=>S.map(T=>T._id===t._id?C.data:T)),c();else throw new Error("Invalid response data")}catch(N){console.error("Task update failed:",N),f.fire("Task update failed")}finally{b(!1)}};return e.jsx(e.Fragment,{children:h&&e.jsx("div",{id:"watchcodeModal",className:"fixed inset-0 bg-black bg-opacity-50 flex items-start justify-center max-h-[100vh] overflow-y-scroll z-[101] py-5",children:e.jsxs("div",{className:"bg-white dark:bg-black rounded-lg shadow-lg p-6 w-full max-w-md",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-primary",children:"Edit Task Details"}),e.jsx("button",{onClick:c,className:`text-gray-500 hover:text-gray-800 dark:text-gray-300 dark:hover:text-white rounded-full ${i?"cursor-not-allowed":""}`,disabled:i,children:"✖"})]}),e.jsxs("form",{onSubmit:l,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"link",className:"block font-bold text-primary mb-2",children:"Link"}),e.jsx("input",{type:"text",id:"link",name:"link",placeholder:"Enter the link here",value:v,onChange:s=>p(s.target.value),required:!0,className:"w-full p-3 border text-[var(--secondary-text-color)] border-gray-300 dark:border-gray-700 rounded focus:ring transition duration-200 ease-in-out"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"watchcode",className:"block font-bold text-primary mb-2",children:"Watchcode"}),e.jsx("textarea",{id:"watchcode",name:"watchcode",rows:"2",placeholder:"Enter the watchcode here",value:m,onChange:s=>d(s.target.value),required:!0,className:"w-full p-3 border text-[var(--secondary-text-color)] border-gray-300 dark:border-gray-700 rounded focus:ring transition duration-200 ease-in-out"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"instructions",className:"block font-bold text-primary mb-2",children:"Instructions"}),e.jsx("textarea",{id:"instructions",name:"instructions",rows:"2",placeholder:"Enter the instructions here",value:g,onChange:s=>u(s.target.value),required:!0,className:"w-full p-3 border text-[var(--secondary-text-color)] border-gray-300 dark:border-gray-700 rounded focus:ring transition duration-200 ease-in-out"})]}),e.jsx("div",{className:"text-center",children:e.jsx("button",{type:"submit",className:"bg-highlight-color hover:bg-secondary-accent-color text-white font-bold py-3 px-6 rounded-lg transition duration-200 ease-in-out",disabled:i,children:i?e.jsx(M,{color:"#ffffff",loading:i,size:8}):"Update"})})]})]})})})},X=()=>{var D,$,U;const{isLoggedIn:a,getStoredUserObj:h,getStoredToken:c,setPageTitle:x}=r.useContext(_),{API_E_VideoBase_url:j,tasks:E,setTasks:w,balance:t,setBalance:v}=r.useContext(I),[p,m]=r.useState(!0),[d,g]=r.useState({}),[u,i]=r.useState({}),[b,k]=r.useState(null),[l,s]=r.useState(!1),[N,y]=r.useState(!1),C=R();r.useEffect(()=>{a()||C("/")},[a,C]),r.useEffect(()=>{x("MANAGE TASKS")},[x]),r.useEffect(()=>{i(h())},[h]);const S=async()=>{m(!0);try{const o=`${j}api/a/v1.00/evideo`,n=await(await fetch(o,{method:"GET",credentials:"include",headers:{"Content-Type":"application/json",authorization:`Bearer ${c()}`}})).json();if(n.status==="success"&&n.data)w(n.data);else throw new Error(n.message)}catch(o){console.error("Request failed:",o)}finally{m(!1)}};r.useEffect(()=>{console.log("isObjLoading",d)},[d]);const T=async o=>{if(window.confirm("Are you sure you want to delete this task?")){g(n=>({...n,[o]:!0}));try{const n=`${j}api/a/v1.00/evideo/${o}`,O=await fetch(n,{method:"DELETE",credentials:"include",headers:{"Content-Type":"application/json",authorization:`Bearer ${c()}`}});if(O.ok)w(L=>L.filter(P=>P._id!==o));else{const L=await O.json();throw new Error(L.message)}}catch(n){console.error("Delete request failed:",n)}finally{g(n=>({...n,[o]:!1}))}}};r.useEffect(()=>{S()},[]);const B=o=>{k(o),s(!0)},F=()=>{y(!0)},z=()=>{s(!1),k(null)},A=()=>{y(!1)};return e.jsxs(e.Fragment,{children:[e.jsx("section",{className:"flex justify-center items-center mx-6 mb-6 mt-10",children:e.jsx("div",{className:"cards-container flex max-w-[850px] flex-wrap w-full justify-center gap-6",children:e.jsxs("div",{className:"bg-[var(--container-bg-color)] w-full flex-grow min-h-16 flex-col flex justify-center items-center rounded-md",children:[e.jsx("h1",{className:"w-full text-center mt-3 text-[var(--highlight-color)] text-2xl",children:`${((D=u.userTitle)==null?void 0:D.toUpperCase())||"User"} 
              ${(($=u.firstName)==null?void 0:$.toUpperCase())||""} 
              ${((U=u.lastName)==null?void 0:U.toUpperCase())||""}`}),e.jsx("p",{className:"w-full text-center m-2",children:e.jsx("b",{onClick:F,className:"bg-[var(--accent-color)] p-1 px-2 rounded",children:"Create Task"})})]})})}),E.map(o=>e.jsx("div",{className:"task-item",children:e.jsx(W,{task:o,isObjLoading:d,handleDeleteTask:T,openModal:B})},o._id)),e.jsx(V,{isOpen:N,onClose:A}),e.jsx(G,{taskID:b,isOpen:l,onClose:z})]})};export{X as default};
