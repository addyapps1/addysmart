import{r as t,A as S,u as P,j as e,L as p}from"./index-DWis4S1t.js";import{S as i}from"./sweetalert2.esm.all-BGf-Fe8G.js";import{B as C}from"./BeatLoader-CfJHUm3g.js";const F=()=>{const{API_base_url:c,handleAlreadyLoggedIn:d,StoreToken:b,StoreUserObj:y,SetReferalId:w,logout:j,setPageTitle:m}=t.useContext(S),[f,h]=t.useState(!1),[s,k]=t.useState({email:"",password:""});t.useEffect(()=>(m(""),()=>{}),[m]);const g=new URLSearchParams(window.location.search),u=parseInt(g.get("refId"));u&&w(u);async function N(){const a=g.get("verify");if(console.log("VerificationToken",a),a)try{let r=`${c}api/a/v1.00/users/verifyemail/${a}`;console.log("VerifyURL",r);const o=await fetch(r,{method:"GET",headers:{"Content-Type":"application/json"}}),n=await o.json();return o.ok?(console.log("Email verified successfully!",n),i.fire("Email verified successfully! Please login"),j(),l("/"),n):(console.error("Failed to verify email:",n.message||n),i.fire("Failed to verify email: "+(n.message||"Unknown error")),null)}catch(r){return console.error("An error occurred while verifying the email:",r),i.fire("An error occurred while verifying the email: "+r.message),null}}N();const l=P();t.useEffect(()=>{d()&&l("/home")},[d,l]);const[x,E]=t.useState(""),v=a=>{k({...s,[a.target.name]:a.target.value})},L=async a=>{a.preventDefault(),h(!0);try{console.log("formData",s);const r=await fetch(`${c}api/a/v1.00/users/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}),o=await r.json();if(r.ok)o.token&&b(o.token),o.data&&y(o.data),console.log("User ",o.data),o.data.role.includes("user")?l("/home"):l("/");else throw Error(`${o.message}`)}catch(r){console.error("Error during login:",r),E(`${r}...`)}h(!1)};return e.jsxs("div",{className:"container my-8 mx-auto max-w-md p-6 bg-[var(--container-bg-color)] border border-[var(--container-border)] rounded-lg shadow-lg",children:[e.jsx("div",{className:" formHeader mb-6 rounded-md",children:e.jsx("h1",{className:"text-2xl font-bold text-[var(--primary-text-color)] text-center",children:"Login"})}),e.jsxs("form",{children:[x&&e.jsx("div",{className:"error-message",children:x}),e.jsx("label",{className:"block mb-2 text-[var(--primary-text-color)] font-bold",htmlFor:"email",children:"Email"}),e.jsx("input",{type:"email",name:"email",placeholder:"Email",value:s.email,onChange:v,id:"email",className:"mb-4 p-2 w-full border rounded text-[var(--secondary-text-color)] border-[var(--dark-gray)] focus:border-[var(--highlight-color)] focus:shadow-md"}),e.jsx("label",{className:"block mb-2 text-[var(--primary-text-color)] font-bold",htmlFor:"password",children:"Password"}),e.jsx("input",{type:"password",name:"password",placeholder:"Password",value:s.password,onChange:v,id:"password",className:"mb-4 p-2 w-full border rounded text-[var(--secondary-text-color)] border-[var(--dark-gray)] focus:border-[var(--highlight-color)] focus:shadow-md"}),e.jsx("button",{onClick:L,type:"submit",className:"w-full mt-7 py-2 bg-[var(--highlight-color)] text-white rounded hover:bg-[var(--secondary-accent-color)] transition duration-300",children:f?e.jsx(C,{color:"#ffffff",loading:f,size:8}):"Login"})]}),e.jsxs("div",{className:"mt-6 flex justify-between bg",children:[e.jsx(p,{to:"/forgotpass",className:"text-[var(--accent-color)] hover:text-[var(--highlight-color)]",children:"Forgot Password?"}),e.jsx(p,{to:"/register",className:"text-[var(--accent-color)] hover:text-[var(--highlight-color)]",children:"Register"})]})]})};export{F as default};
