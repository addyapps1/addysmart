import{r,A as E,u as R,j as e,L as $}from"./index-CjYO5HdS.js";import{S as u}from"./sweetalert2.esm.all-BGf-Fe8G.js";import{A as T}from"./AuthHelmet-EAF1nPXA.js";import{C as M}from"./ConfirmPasswordStrengthModal-L48ll7sT.js";import{B}from"./BeatLoader-Cw3v0UOt.js";import"./Helmet-DlaOlHX7.js";const z=()=>{const{API_base_url:b,APP_NAME:f}=r.useContext(E),[v,P]=r.useState(""),[t,y]=r.useState(""),[l,j]=r.useState(""),[n,h]=r.useState(!1),[g,a]=r.useState(""),C=R(),[p,w]=r.useState(!1),[d,N]=r.useState(!1),x=r.useRef(null),i=r.useRef(!0);r.useEffect(()=>{const c=new URLSearchParams(window.location.search).get("resetToken");c?P(c):a("Invalid or missing token.")},[]);const S=s=>{console.log("response",s),i.current=s,N(s),s&&x.current.click(),console.log("Confirmed",d),w(!1)},k=async s=>{if(s.preventDefault(),t!==l){a("Passwords do not match."),u.fire("Passwords do not match.");return}if(t.length<8)return a("Passwords must be at least 8 characters"),u.fire("Passwords must be at least 8 characters"),!1;if(console.log("Confirmed status:",d,"Proceed status:",i.current),!d&&!p){const o=/[a-z]/.test(t),m=/[A-Z]/.test(t),A=/[0-9]/.test(t),L=/[!@#$%^&*]/.test(t);if(!o||!m||!A||!L)return console.log("Password strength check failed"),w(!0),i.current=!1,!1}h(!0),a("");const c={password:t,confirmPassword:l};try{const o=await fetch(`${b}api/a/v1.00/users/resetpassword/${v}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)}),m=await o.json();if(o.ok)u.fire("Password reset successfully! Please log in."),C("/login");else throw new Error(m.message||"An error occurred during the password reset.")}catch(o){console.error("Error during password reset:",o),a(`Error: ${o.message}`)}finally{h(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(T,{pageDescription:`Welcome to ${f.toLowerCase()} reset password page.`,pageName:"resetpass",pageTitle:`${f} - reset password`}),e.jsxs("div",{className:"container my-8 mx-auto max-w-md p-6 bg-[var(--container-bg-color)] border border-[var(--container-border)] rounded-lg shadow-lg",children:[e.jsx("div",{className:"formHeader mb-6 rounded-md",children:e.jsx("h1",{className:"text-2xl font-bold text-[var(--primary-text-color)] text-center",children:"Reset Password"})}),e.jsxs("form",{onSubmit:k,children:[e.jsx("label",{className:"block mb-2 text-[var(--primary-text-color)] font-bold",htmlFor:"password",children:"New Password"}),e.jsx("input",{type:"password",id:"password",value:t,onChange:s=>y(s.target.value),className:"mb-4 p-2 w-full border rounded text-[var(--secondary-text-color)] border-[var(--dark-gray)] focus:border-[var(--highlight-color)] focus:shadow-md",required:!0}),e.jsx("label",{className:"block mb-2 text-[var(--primary-text-color)] font-bold",htmlFor:"confirm-password",children:"Confirm New Password"}),e.jsx("input",{type:"password",id:"confirm-password",value:l,onChange:s=>j(s.target.value),className:"mb-4 p-2 w-full border rounded text-[var(--secondary-text-color)] border-[var(--dark-gray)] focus:border-[var(--highlight-color)] focus:shadow-md",required:!0}),g&&e.jsx("p",{className:"text-red-500 text-sm mb-4",children:g}),e.jsx("button",{ref:x,type:"submit",className:`w-full mt-7 py-2 ${n?"bg-gray-400":"bg-[var(--highlight-color)]"} text-white rounded hover:bg-[var(--secondary-accent-color)] transition duration-300`,disabled:n,children:n?e.jsx(B,{color:"#ffffff",loading:n,size:8}):"Reset Password"})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx($,{to:"/login",className:"text-[var(--accent-color)] hover:text-[var(--highlight-color)]",children:"Back to Login"})})]}),p&&e.jsx(M,{handleConfirm:S})]})};export{z as default};
