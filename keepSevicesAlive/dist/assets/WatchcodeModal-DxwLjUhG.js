import{j as e,r as o,A as S,u as C}from"./index-CjYO5HdS.js";import{S as r}from"./sweetalert2.esm.all-BGf-Fe8G.js";import{M as T}from"./AddyMine-RVErtJP2.js";import{c as k}from"./line-md--menu-to-close-transition-CEm-3zyw.js";import{B as M}from"./BeatLoader-Cw3v0UOt.js";const $=({task:t,onWatchCodeClick:n,alertViewed:s})=>e.jsx("section",{className:"flex justify-center items-center mx-6 mb-14",children:e.jsxs("div",{className:"bg-[var(--container-bg-color)] text-[var(--highlight-color)] cards-container flex max-w-[850px] flex-wrap w-full justify-center gap-6 rounded-md",children:[e.jsxs("div",{className:"w-full px-4 flex-grow min-h-16 flex justify-center flex-col items-center rounded-md",children:[e.jsx("h2",{className:"w-full text-center",children:"INSTRUCTIONS"}),e.jsx("b",{children:t.instructions})]},t._id),e.jsx("div",{onClick:t.justViewed?s:n,className:"basis-80 flex-grow min-h-16  flex justify-center items-center rounded-md bg-[var(--accent-color)] max-w-[400px]",children:e.jsx("a",{href:t.link,target:"_blank",rel:"noopener noreferrer",className:`button h-full flex justify-center items-center ${t.justViewed?"text-[var(--bad)]":"text-[var(--good)]"} w-full rounded text-center`,children:t.justViewed?"Done":"Do Task"})})]})}),P=({videoId:t,isOpen:n,onClose:s})=>{const{logout:x,getStoredToken:g}=o.useContext(S),{API_MineBase_url:p,setTasks:j,setBalance:w}=o.useContext(T),[i,b]=o.useState(""),[l,c]=o.useState(!1),y=C(),v=()=>i.trim()?!0:(r.fire("Watchcode cannot be empty"),!1),N=async d=>{if(d.preventDefault(),c(!0),!v()){c(!1);return}try{console.log("WatchcodeModal videoId",t);const a=await(await fetch(`${p}api/a/v1.00/coinmining`,{method:"POST",headers:{"Content-Type":"application/json",authorization:`Bearer ${g()}`},body:JSON.stringify({watchcode:i,videoId:t})})).json();if(console.log("data",a),a&&a.alreadydone)r.fire(`${a.alreadydone}`);else if(a&&a.data)r.fire(`${a.data.newCoins} shares mined successfully`),j(f=>{console.log("Previous tasks:",f);const h=f.map(m=>m._id===t?{...m,justViewed:!0}:m);return console.log("Updated tasks:",h),h}),w(a.data),s();else throw new Error("Invalid response data")}catch(u){console.error("Shares mining failed:",u),r.fire("Shares mining failed"),u=="Error: jwt expired"&&(r.fire("Your login expired, please login again."),x(),y("/"))}finally{c(!1)}};return e.jsx(e.Fragment,{children:n&&e.jsx("div",{id:"watchcodeModal",className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center max-h-[95vh] overflow-y-scroll z-[101] my-5",children:e.jsxs("div",{className:"bg-white dark:bg-black rounded-lg shadow-lg p-6 w-full max-w-md",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-primary",children:"Watchcode challenge"}),e.jsx("div",{children:e.jsx("img",{src:k,alt:"profileImage",className:"pagelogo w-6 aspect-square rounded-full mx-auto",title:"close modal",onClick:s})})]}),e.jsxs("form",{onSubmit:N,className:"space-y-6",children:[e.jsx("input",{type:"hidden",name:"video-id",value:t}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"watchcode",className:"block font-bold text-primary mb-2",children:"Watchcode"}),e.jsx("textarea",{id:"watchcode",name:"watchcode",rows:"2",placeholder:"Enter the watchcode here",value:i,onChange:d=>b(d.target.value),required:!0,className:"w-full p-3 text-[var(--secondary-text-color)] border border-gray-300 dark:border-gray-700 rounded focus:ring focus:ring-highlight-color transition duration-200 ease-in-out"})]}),e.jsx("div",{className:"text-center",children:e.jsx("button",{type:"submit",className:"bg-highlight-color hover:bg-secondary-accent-color text-white font-bold py-3 px-6 rounded-lg transition duration-200 ease-in-out",disabled:l,children:l?e.jsx(M,{color:"#ffffff",loading:l,size:8}):"Mine"})})]})]})})})};export{$ as T,P as W};
