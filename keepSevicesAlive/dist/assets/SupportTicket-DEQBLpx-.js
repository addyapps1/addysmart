import{j as e,r,A as v,u as w}from"./index-CjYO5HdS.js";import"./sweetalert2.esm.all-BGf-Fe8G.js";import{M as T}from"./AddyMine-RVErtJP2.js";import{M as b}from"./MineHelmet-DI-3rin1.js";import{B as k}from"./BeatLoader-Cw3v0UOt.js";import"./useClickOutside-CGyhsngc.js";import"./Helmet-DlaOlHX7.js";const C=({supportticket:t,onOpenTicket:c})=>e.jsx("section",{className:"flex justify-center items-center mx-6 mb-14",children:e.jsxs("div",{className:"bg-[var(--container-bg-color)] text-[var(--highlight-color)] cards-container flex max-w-[850px] flex-wrap w-full justify-center gap-6 rounded-md",children:[e.jsxs("div",{className:"flex-grow min-h-16 flex justify-center flex-col items-center rounded-md",children:[e.jsxs("h2",{className:"w-full text-center font-semibold",children:["Title: ",t.issueTitle]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Description: ",t.issueDescription]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Priority: ",t.priority]})]}),e.jsxs("div",{className:"flex-grow min-h-16 flex justify-center flex-col items-center rounded-md",children:[e.jsxs("h2",{className:"w-full text-center font-semibold",children:["status: ",t.status]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["category:",t.categor]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["created: ",t.created]})]}),e.jsx("div",{className:"w-full flex justify-center items-center rounded-md",children:e.jsx("div",{onClick:c,role:"button","aria-label":"Open support ticket",className:"w-full flex-grow min-h-16 flex justify-center items-center rounded-md bg-[var(--accent-color)] max-w-[400px] cursor-pointer hover:bg-opacity-90",children:"Read"})})]})}),$=()=>{var p,f,u;const{isLoggedIn:t,getStoredUserObj:c,getStoredToken:g,setPageTitle:n}=r.useContext(v),{API_supportBase_url:j,supportTickets:i,setSupportTickets:y}=r.useContext(T),[d,m]=r.useState(!1),[o,N]=r.useState({}),l=w();r.useEffect(()=>{t()||l("/")},[t,l]),r.useEffect(()=>{n("SUPPORT TICKET"),N(c())},[c,n]);const x=async()=>{m(!0);try{const s=`${j}api/a/v1.00/supportticket`;console.log("supportticketURL",s);const h=await fetch(s,{method:"GET",headers:{"Content-Type":"application/json",authorization:`Bearer ${g()}`}});console.log("response",h);const a=await h.json();if(a.status==="success"&&a.data)console.log("Fetched Support Tickets:",a.data),y(a.data),console.log("supportTickets",i);else throw new Error(a.message||"Failed to fetch support tickets.")}catch(s){console.error("Request failed:",s)}finally{m(!1)}};return r.useEffect(()=>{x()},[]),e.jsxs(e.Fragment,{children:[e.jsx(b,{pageDescription:"Welcome to Addysmart mining support ticket page where you can view all available support tickets.",pageName:"addymine/supportticket",pageTitle:"Addysmart - Support Tickets"}),e.jsx("section",{className:"flex justify-center items-center mx-6 mb-6 mt-10",children:e.jsx("div",{className:"cards-container flex max-w-[850px] flex-wrap w-full justify-center gap-6",children:e.jsxs("div",{className:"bg-[var(--container-bg-color)] w-full flex-grow min-h-16 flex-col flex justify-center items-center rounded-md",children:[e.jsxs("h1",{className:"w-full text-center mt-5 m-0 text-[var(--highlight-color)] text-2xl",children:[`${((p=o.userTitle)==null?void 0:p.toUpperCase())||"User"} 
              ${((f=o.firstName)==null?void 0:f.toUpperCase())||""} 
              ${((u=o.lastName)==null?void 0:u.toUpperCase())||""}`,o.isVIP&&e.jsx("em",{className:"text-[var(--good)]",children:" (VIP)"})]}),e.jsx("p",{className:"w-full text-center m-2",children:e.jsx("b",{onClick:x,className:"bg-[var(--accent-color)] p-1 px-2 rounded cursor-pointer",children:"Reload Tickets"})})]})})}),d?e.jsx("div",{className:"flex justify-center items-center mt-10",children:e.jsx(k,{color:"#ffffff",loading:d,size:8})}):i&&i.length>0?i.map(s=>e.jsx("div",{className:"ticket-item",children:e.jsx(C,{supportticket:s,onOpenTicket:()=>l(`../ticketchat/${s._id}`)})},s._id)):e.jsx("div",{className:"flex justify-center items-center mt-10",children:"You have no support ticket yet."})]})};export{$ as default};
