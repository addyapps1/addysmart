import{j as t,r as a,A as b,u as I}from"./index-CjYO5HdS.js";import{M as D}from"./AddyMine-RVErtJP2.js";import{a as S}from"./useClickOutside-CGyhsngc.js";import{P as A}from"./Pagination-DZWbd18p.js";import{M as L}from"./MineHelmet-DI-3rin1.js";import{S as M}from"./sweetalert2.esm.all-BGf-Fe8G.js";import{B as T}from"./BeatLoader-Cw3v0UOt.js";import"./Helmet-DlaOlHX7.js";const B=({rUser:e})=>{var i,d,n,c,p,f,g,m,u;let l=S;return(i=e==null?void 0:e.profileImg)!=null&&i.filePath&&(l=e.profileImg.filePath),console.log("rUser",e),t.jsx("section",{className:"flex justify-center items-center mx-6 mb-6",children:t.jsx("div",{className:"bg-[var(--container-bg-color)] text-[var(--highlight-color)] cards-container flex max-w-[850px] flex-wrap w-full justify-center gap-6 rounded-md",children:t.jsxs("div",{className:"w-full flex-grow min-h-16 flex justify-between items-center rounded-md p-4",children:[t.jsx("b",{className:" flex-grow",children:`${((n=(d=e==null?void 0:e.referred)==null?void 0:d.userTitle)==null?void 0:n.toUpperCase())||""} 
              ${((p=(c=e==null?void 0:e.referred)==null?void 0:c.firstName)==null?void 0:p.toUpperCase())||""} 
              ${((g=(f=e==null?void 0:e.referred)==null?void 0:f.middleName)==null?void 0:g.toUpperCase())||""} 
              ${((u=(m=e==null?void 0:e.referred)==null?void 0:m.lastName)==null?void 0:u.toUpperCase())||""}`}),t.jsx("img",{src:l,alt:"profileImage",className:" w-10 aspect-square rounded-full mx-auto",title:"profile image"})]})})})},Y=()=>{var P,R,C;const{logout:e,isLoggedIn:l,getStoredUserObj:i,getStoredToken:d,setPageTitle:n,APP_NAME:c}=a.useContext(b),{API_AuthBase_url:p,referrals:f,setReferrals:g}=a.useContext(D),[m,u]=a.useState(!1),[r,E]=a.useState({}),[x,y]=a.useState(1),[j,v]=a.useState(0),w=12;let N=a.useRef();const h=I();a.useEffect(()=>{l()||h("/")},[l,h]),a.useEffect(()=>{n("REFERRALS")},[n]),a.useEffect(()=>{const s=i();E(s),console.log("User.referalID",s.referalID)},[i]);const $=async()=>{if(r.referalID){u(!0),console.log("Fetching data for user:",r);try{const s=`${p}api/a/v1.00/referral/user?page=${x}&limit=${w}`,o=await(await fetch(s,{method:"GET",headers:{"Content-Type":"application/json",authorization:`Bearer ${d()}`}})).json();if(o.status==="success"&&o.data)g(o.data),console.log("ReferralsData",o),v(o.RecordsEstimate||0);else throw new Error(o.message)}catch(s){s=="Error: jwt expired"&&(M.fire("Your login expired, please login again."),e(),h("/")),console.error("Request failed:",s.message)}finally{u(!1)}}};return N.current=$,a.useEffect(()=>{r.referalID&&N.current()},[x,r.referalID]),t.jsxs(t.Fragment,{children:[t.jsx(L,{pageDescription:`Welcome to ${c.toLowerCase()} mining referrals page, where you see data about your referrals`,pageName:"addymine/referrals",pageTitle:`${c} - Mining referrals`}),t.jsx("section",{className:"flex justify-center items-center mx-6 mb-6 mt-10",children:t.jsx("div",{className:"cards-container flex max-w-[850px] flex-wrap w-full justify-center gap-6",children:t.jsxs("div",{className:"bg-[var(--container-bg-color)] w-full flex-grow min-h-16 flex-col flex justify-center items-center rounded-md",children:[t.jsx("h1",{className:"w-full text-center mt-5 m-0 text-[var(--highlight-color)] text-2xl",children:`${((P=r.userTitle)==null?void 0:P.toUpperCase())||"User"} 
              ${((R=r.firstName)==null?void 0:R.toUpperCase())||"Unknown"} 
              ${((C=r.lastName)==null?void 0:C.toUpperCase())||"User"}`}),t.jsx("p",{className:"w-full text-center mb-2",children:"Referrals"})]})})}),m?t.jsx("div",{className:"flex justify-center items-center mt-10",children:t.jsx(T,{color:"#ffffff",loading:m,size:8})}):f.length>0?f.map(s=>t.jsx("div",{className:"task-item",children:t.jsx(B,{rUser:s})},s._id)):t.jsx("p",{className:"text-center",children:"No referrals found."}),j>0&&t.jsx(A,{totalPages:Math.ceil(j/w)||1,currentPage:x,onPageChange:y})]})};export{Y as default};
